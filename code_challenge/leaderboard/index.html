<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCU Code Challenge Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=VT323&display=swap" rel="stylesheet">
    
    <style>
        /* Custom Variables and Global Styles */
        :root {
            --primary-color: rgb(170, 49, 86);
            --secondary-color: rgb(47, 93, 160);
            --text-color: rgb(255, 255, 255);
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            background-image: radial-gradient(circle, #2a3c30 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-color);
        }

        .vt323-regular {
            font-family: 'VT323', monospace;
        }

        /* Card and Fade-in Effect */
        .card {
            background: rgba(22, 27, 34, 0.9);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            animation: fadeIn 1.5s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Input Field Styling */
        .form-input {
            background-color: #161b22;
            border-color: #30363d;
            color: var(--text-color);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(170, 49, 86, 0.5);
        }
        
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-4 md:p-8">

    <div class="w-full max-w-4xl pt-4">

        <div id="leaderboard-section" class="w-full pt-8 space-y-4">
            <h1 class="text-4xl md:text-5xl vt323-regular text-center mb-6" style="color: var(--primary-color); text-shadow: 0 0 10px var(--primary-color);">
                UCU CODE CHALLENGE LEADERBOARD ðŸ“Š
            </h1>

            <div class="flex flex-col sm:flex-row justify-between items-center mb-4 p-3 card rounded-lg">
                <label for="round-select" class="text-sm font-medium text-gray-300">Filter By Round:</label>
                <select id="round-select" 
                        class="form-input mt-2 sm:mt-0 px-3 py-2 border rounded-md shadow-sm text-sm w-full sm:w-1/3 cursor-pointer">
                    <option value="all">All Rounds (Cumulative)</option>
                    </select>
            </div>

            <div class="overflow-x-auto card p-4 rounded-xl shadow-2xl">
                <table id="leaderboard-table" class="min-w-full divide-y divide-gray-700">
                    <thead>
                        <tr class="text-xs font-semibold uppercase tracking-wider text-gray-400 bg-gray-800">
                            <th class="px-4 py-3 text-left">Rank</th>
                            <th class="px-4 py-3 text-left">Team / Member</th>
                            <th class="px-4 py-3 text-center">Round</th>
                            <th class="px-4 py-3 text-center">Score</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body" class="bg-gray-900 divide-y divide-gray-700">
                        <tr>
                            <td colspan="4" class="py-4 text-center text-gray-500">Loading leaderboard...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>

</body>
<script>
    // --- Leaderboard Logic ---
    let leaderboardData = [];

    // DOM elements
    const roundSelect = document.getElementById('round-select');
    const leaderboardBody = document.getElementById('leaderboard-body');

    /**
     * Fetches and processes the leaderboard data from the JSON file.
     */
    async function fetchLeaderboardData() {
        try {
            // Fetch data from the external JSON file
            const response = await fetch('leaderboard_data.json'); 
            
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            leaderboardData = await response.json();
            
            // 1. Populate the filter dropdown options
            populateRoundFilter(leaderboardData);

            // 2. Initial render: show all rounds (cumulative)
            renderLeaderboard('all');

        } catch (error) {
            console.error("Error fetching leaderboard data. Ensure 'leaderboard_data.json' is present and you are running on a server:", error);
            // Updated colspan back to 4
            leaderboardBody.innerHTML = `<tr><td colspan="4" class="py-4 text-center text-red-400">
                Error loading data. Check console (F12) for file errors (e.g., CORS).
            </td></tr>`;
        }
    }

    /**
     * Populates the round selection dropdown with unique round numbers.
     * @param {Array} data - The full array of submission data.
     */
    function populateRoundFilter(data) {
        const uniqueRounds = [...new Set(data.map(item => item.round))].sort((a, b) => a - b);
        
        roundSelect.querySelectorAll('option:not([value="all"])').forEach(option => option.remove());

        uniqueRounds.forEach(round => {
            const option = document.createElement('option');
            option.value = round;
            option.textContent = 'Round ' + round;
            roundSelect.appendChild(option);
        });
        
        // Attach the change listener
        if (!roundSelect.hasEventListener) {
            roundSelect.addEventListener('change', (e) => {
                renderLeaderboard(e.target.value);
            });
            roundSelect.hasEventListener = true;
        }
    }

    /**
     * Filters, sorts, and renders the leaderboard table.
     * @param {string | number} filterValue - The round number or 'all'.
     */
    function renderLeaderboard(filterValue) {
        let filteredData = [];

        if (filterValue === 'all') {
            // For 'All Rounds', we group by participant and calculate the cumulative score
            
            const cumulativeScores = new Map();

            leaderboardData.forEach(item => {
                // Key is the participant's name (which is sufficient due to the data standardization)
                const key = item.participantName;
                
                if (!cumulativeScores.has(key)) {
                    cumulativeScores.set(key, { name: key, totalScore: 0 });
                }
                cumulativeScores.get(key).totalScore += item.score;
            });

            // Convert map to array and use totalScore for rendering
            filteredData = Array.from(cumulativeScores.values()).map(item => ({
                name: item.name,
                score: item.totalScore,
                round: 'Cumulative'
            }));

        } else {
            // For specific rounds, filter by the round number
            const roundNum = parseInt(filterValue);
            
            // Use a Map to ensure only one entry per participant/team (based on participantName)
            const uniqueSubmissions = new Map();
            
            leaderboardData
                .filter(item => item.round === roundNum)
                .forEach(item => {
                    // Key is the participant's name
                    const key = item.participantName;

                    // Ensure only one entry per participant per round is counted
                    if (!uniqueSubmissions.has(key)) {
                        uniqueSubmissions.set(key, {
                            name: key, // This is the participantName
                            score: item.score,
                            round: item.round
                        });
                    }
                });
            
            filteredData = Array.from(uniqueSubmissions.values());
        }

        // Sort by score (descending)
        filteredData.sort((a, b) => b.score - a.score);

        // --- Render Table ---
        leaderboardBody.innerHTML = ''; 

        // Changed colspan back to 4
        if (filteredData.length === 0) {
            leaderboardBody.innerHTML = `<tr><td colspan="4" class="py-4 text-center text-gray-500">No submissions found for this round.</td></tr>`;
            return;
        }

        filteredData.forEach((item, index) => {
            const rank = index + 1;
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-800 transition-colors duration-150';
            
            // Highlight top ranks
            const rankClass = rank === 1 ? 'text-yellow-400 font-bold' : (rank <= 3 ? 'text-gray-300 font-medium' : 'text-gray-400');

            // Re-inserted the participant name column (item.name)
            row.innerHTML = `
                <td class="px-4 py-3 whitespace-nowrap ${rankClass}">${rank}</td>
                <td class="px-4 py-3 font-medium text-white">${item.name}</td>
                <td class="px-4 py-3 text-center text-sm text-gray-300">${item.round}</td>
                <td class="px-4 py-3 text-center font-bold text-lg text-green-400">${item.score}</td>
            `;
            leaderboardBody.appendChild(row);
        });
    }

    window.addEventListener('load', fetchLeaderboardData);
</script>
</html>